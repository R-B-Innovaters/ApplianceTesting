@model ApplianceTesting.Models.CompanyModel

<div class="container card p-5" style="margin-top:5%">
    <h3>Add Company</h3>
    <hr />
    <form asp-action="AddCompany" asp-controller="Master" method="post">
        <div class="row">
            <div class="col-sm-12">
                <div class="row">
                    <div class="col-md-6 mb-2">
                        <label class="form-label">Company Name</label>
                        <input type="text" class="form-control" asp-for="CompanyName" placeholder="Enter Company Name">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Company Number</label>
                        <input type="text" class="form-control" asp-for="CompanyNumber" placeholder="Enter Company Number">
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-4 mb-2">
                        <label class="form-label">Contact No</label>
                        <input type="text" class="form-control" asp-for="ContactNo" placeholder="Enter Company Contact No">
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Email</label>
                        <input type="text" class="form-control" asp-for="CompanyEmail" placeholder="Enter Company Email Id">
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Address</label>
                        <input type="text" class="form-control" asp-for="CompanyAddress" placeholder="Enter Company Address">
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-4 mb-2">
                        <label class="form-label">State</label>
                        <select id="StateId" name="StateId" class="form-control" onchange="fetchCities(this.value)">
                            <option value="">-- Select State --</option>
                            @if (ViewBag.stateList != null)
                            {
                                foreach (var state in ViewBag.stateList)
                                {
                                    <option value="@state.StateId">@state.StateName</option>
                                }
                            }
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">City</label>
                        <select id="CityId" name="CityId" class="form-control" onchange="fetchLocations(this.value)">
                            <option value="">-- Select City --</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Location</label>
                        <select id="LocationId" asp-for="LocationId" class="form-control">
                            <option value="">-- Select Location --</option>
                        </select>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-4">
                        <label class="form-label">Company Registration Date</label>
                        <input type="text" id="datepicker" class="form-control datepicker" asp-for="CompRegistrationDate" placeholder="Select Registration Date">
                    </div>
                    <div class="col-md-4 mb-2">
                        <label class="form-label">Status</label><br />
                        <label class="switch">
                            <input type="checkbox" asp-for="CompanyStatus">
                            <span class="slider round"></span>
                        </label>
                    </div>
                </div>
                <div class="row float-end">
                    <div class="col-md-12 mb-2">
                        <button type="reset" class="btn btn-secondary">Cancel</button>
                        <button type="submit" class="btn btn-primary">Submit</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-sm-12">
                <table class="table datatableCss" id="myTable">
                    <thead>
                        <tr>
                            <th>CompanyName</th>
                            <th>CompanyNumber</th>
                            <th class="text-wrap">CompanyEmail</th>

                            <th>ContactNo </th>
                            <th>CompanyAddress</th>
                            <th>CompanyStatus</th>
                            <th>CompRegistrationDate </th>
                        </tr>
                    </thead>
                    @if (ViewBag.compList != null)
                    {
                        foreach (var item in ViewBag.compList)
                        {
                            <tr>
                                <td>@item.CompanyName</td>
                                <td>@item.CompanyNumber</td>
                                <td>@item.CompanyEmail</td>

                                <td>@item.ContactNo </td>
                                <td>@item.CompanyAddress</td>
                                <td>
                                    <label class="switch">
                                        <input type="checkbox" class="status-switch" data-id="@item.CompanyId" data-table="CompanyMaster" @(item.CompanyStatus ? "checked" : "") data-idcolumn="CompanyId" data-stcolumn="CompanyStatus">
                                        <span class="slider round"></span>
                                    </label>
                                </td>
                                <td>@Convert.ToDateTime(item.CompRegistrationDate).ToString("dd-MM-yyyy") </td>
                            </tr>
                        }
                    }

                </table>
            </div>
        </div>
    </form>

    @*  <h3>Records</h3>
    <hr />
    <table class="table" id="myTable">
    <thead>
    <tr>
    <th>State</th>
    <th>City</th>
    <th>Area</th>
    </tr>
    </thead>
    @if (ViewBag.locations != null)
    {
    foreach (var item in ViewBag.locations)
    {
    <tr>
    <td>@item.LocationName</td>
    <td>@item.CityName</td>
    <td>@item.StateName</td>
    </tr>
    }
    }

    </table> *@


</div>

<script>
    function fetchCities(stateId) {
        if (stateId) {
            $.ajax({
                url: '@Url.Action("GetCitiesByState", "Master")',
                type: 'GET',
                data: { stateId: stateId },
                success: function (data) {
                    var citySelect = $('#CityId');
                    citySelect.empty(); // Clear existing options
                    citySelect.append('<option value="">-- Select City --</option>');
                    $.each(data, function (i, city) {
                        debugger
                        citySelect.append('<option value="' + city.id + '">' + city.name + '</option>');
                    });
                }
            });
        } else {
            $('#CityId').empty().append('<option value="">-- Select City --</option>');
        }
    }

    function fetchLocations(cityId) {
        if (cityId) {
            $.ajax({
                url: '@Url.Action("GetLocationsByCity", "Master")',
                type: 'GET',
                data: { cityId: cityId },
                success: function (data) {
                    var locationSelect = $('#LocationId');
                    locationSelect.empty();
                    locationSelect.append('<option value="">-- Select Location --</option>');
                    $.each(data, function (i, location) {
                        debugger
                        locationSelect.append('<option value="' + location.id + '">' + location.name + '</option>');
                    });
                }
            });
        } else {
            $('#CityId').empty().append('<option value="">-- Select City --</option>');
        }
    }
</script>
